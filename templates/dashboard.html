<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>GlobalInvest ‚Äî –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <link rel="stylesheet" href="static/css/dashboard.css"> 
</head>
<body data-theme="dark">
  <script>
    // –£–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    document.addEventListener("DOMContentLoaded", () => {
      const flash = document.querySelector(".flash-message");
      if (flash) {
        setTimeout(() => {
          flash.style.opacity = '0';
          setTimeout(() => flash.remove(), 500);
        }, 5000);
      }
    });
  </script>
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for msg in messages %}
        <div class="flash-message" onclick="this.remove()">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}


  <!-- –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω -->
  <div class="gradient-bg"></div>
  
  <!-- –ß–∞—Å—Ç–∏—Ü—ã -->
  <div id="particles-js"></div>
  
  <!-- –®–∞–ø–∫–∞ -->
  <header id="header">
    <div class="logo">
      <span class="logo-icon">üìà</span>
      GlobalInvest
    </div>
    
    <nav class="nav-links">
      <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="#balance">–ë–∞–ª–∞–Ω—Å</a>
      <a href="#assets">–ê–∫—Ç–∏–≤—ã</a>
      <a href="/logout">–í—ã–π—Ç–∏</a>
      <button id="support-chat-toggle" class="btn btn-primary" style="margin-left:10px;">–ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏</button>
    </nav>
    
    <button class="theme-toggle" onclick="toggleTheme()">‚òÄÔ∏è</button>
  </header>
  
  <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
  <main class="main-content">
    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <section class="welcome-section">
      <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ first_name }}!</h1>
      <p>–í–∞—à –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è–º–∏. –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –±–∞–ª–∞–Ω—Å, —É–ø—Ä–∞–≤–ª—è—Ç—å –∞–∫—Ç–∏–≤–∞–º–∏ –∏ —Å–æ–≤–µ—Ä—à–∞—Ç—å —Å–¥–µ–ª–∫–∏.</p>
    </section>
    
    <!-- –ë–∞–ª–∞–Ω—Å -->
    <section id="balance" class="balance-section">
      <div class="balance-card">
        <div class="balance-info">
          <h2>–í–∞—à –±–∞–ª–∞–Ω—Å</h2>
          <h1>${{ balance }}</h1>
        </div>
        <div class="balance-actions">
          <button onclick="openModal('deposit')" class="btn btn-primary">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="19" x2="12" y2="5"></line>
              <polyline points="5 12 12 5 19 12"></polyline>
            </svg>
            –ü–æ–ø–æ–ª–Ω–∏—Ç—å
          </button>
          <button onclick="openModal('withdraw')" class="btn btn-secondary">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <polyline points="19 12 12 19 5 12"></polyline>
            </svg>
            –í—ã–≤–µ—Å—Ç–∏
          </button>
        </div>
      </div>
    </section>
    
    <!-- –ê–∫—Ç–∏–≤—ã -->
    <section id="assets" class="assets-section">
      <h2>–ê–∫—Ç–∏–≤—ã</h2>
      
      <div class="assets-grid">
        <!-- –ê–∫—Ç–∏–≤ 1 -->
        {% for asset in assets %}
        <div class="asset-card" data-delay="0">
          <div class="asset-header">
            <div class="asset-icon">
              <img src="{{ asset[3] }}" height="50px">
            </div>
            <div>
              <div class="asset-name">{{ asset[1] }}</div>
            </div>
          </div>
          <div class="asset-details">
            <div class="asset-row">
              <span class="asset-label">–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞:</span>
              <span class="asset-value">{{ asset[2] }}</span>
            </div>
            <!-- <div class="asset-row"> -->
            <!--   <span class="asset-label">–í –≤–∞—à–µ–º –ø–æ—Ä—Ç—Ñ–µ–ª–µ:</span> -->
            <!--   <span class="asset-value"></span> -->
            <!-- </div> -->
            <div class="asset-row">
              <span class="asset-label">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≥—Ä–∞—Ñ–∏–∫–æ–≤:</span>
              <span class="asset-value">–ê–∫—Ç–∏–≤–µ–Ω</span>
            </div>
            <div class="asset-row">
              <span class="asset-label"></span>
              <span class="asset-value" style="color: var(--accent-primary)"></span>
            </div>
          </div>
          <div class="asset-actions">
            <a class="asset-btn sell" href="{{ url_for('view_asset', asset_name=asset[0]) }}">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≥—Ä–∞—Ñ–∏–∫</a>
          </div>
          <div class="asset-actions" style="margin-top: 20px;"> 

            <form method="post" action="{{ url_for('toggle_asset') }}" style="width: 100%;">
              <input type="hidden" name="asset_name" value="{{asset[0]}}">
              <input type="hidden" name="asset_price" value="{{asset[1]}}">
              <div style="width: 100%; display: inline-block;">
                 <button type="submit" class="asset-btn sell" style="
                    width: 80%;">
                  {% if asset[0] in user_assets.keys() %}
                    <input type="hidden" name="action" value='sell'> 
                    –ü—Ä–æ–¥–∞—Ç—å
                  {% else %}
                    <input type="hidden" name="action" value='buy'>
                    –ö—É–ø–∏—Ç—å
                  {% endif %}
                </button>

                <input 
                  name="asset_amount" 
                  style="width: 10%; height: 30px; margin-left: 6%;
                    background: none;
                    border-radius: 5px;
                    color: white;
                    padding-left: 3px;
                    -webkit-appearance: none;
                    "
                  type="number"
                  placeholder="0"
                  min='0'
                  required> 
              </div> 
            </form>  
          </div>

        </div>
        {% endfor %}
      </div>
    </section>
  </main>
  
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–∞ -->
  <div id="depositModal" class="modal-overlay">
    <div class="modal-container">
      <span class="modal-close" onclick="closeModal()">&times;</span>
      <div class="modal-header">
        <h3>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞</h3>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è ($)</label>
          <input type="number" class="form-input" id="depositAmount" min="100" step="0.01" placeholder="1000.00">
          <div class="error-message" id="depositError">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –±–æ–ª—å—à–µ 100$</div>
        </div>
        <div class="form-group">
          <label class="form-label">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</label>
          <select class="form-input">
            <option>–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</option>
            <option>–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</option>
            <option>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –∫–æ—à–µ–ª–µ–∫</option>
            <option>–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn btn-primary" onclick="confirmDeposit()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>
  
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–≤–æ–¥–∞ -->
  <div id="withdrawModal" class="modal-overlay">
    <div class="modal-container">
      <span class="modal-close" onclick="closeModal()">&times;</span>
      <div class="modal-header">
        <h3>–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">–°—É–º–º–∞ –≤—ã–≤–æ–¥–∞ ($)</label>
          <input type="number" class="form-input" id="withdrawAmount" min="100" step="0.01" placeholder="1000.00">
          <div class="error-message" id="withdrawError">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –±–æ–ª—å—à–µ 100$</div>
        </div>
        <div class="form-group">
          <label class="form-label">–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –≤—ã–≤–æ–¥–∞</label>
          <textarea class="form-input form-textarea" id="withdrawDetails" placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã/—Å—á–µ—Ç–∞, –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –∏ —Ç.–¥."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn btn-primary" onclick="confirmWithdraw()">–í—ã–≤–µ—Å—Ç–∏</button>
      </div>
    </div>
  </div>
  
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–∫—É–ø–∫–∏/–ø—Ä–æ–¥–∞–∂–∏ -->
  <div id="tradeModal" class="modal-overlay">
    <div class="modal-container">
      <span class="modal-close" onclick="closeModal()">&times;</span>
      <div class="modal-header">
        <h3 id="tradeModalTitle">–ü–æ–∫—É–ø–∫–∞ –∞–∫—Ü–∏–π</h3>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">–ê–∫—Ç–∏–≤</label>
          <input type="text" class="form-input" id="tradeAsset" readonly>
        </div>
        <div class="form-group">
          <label class="form-label">–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞</label>
          <input type="text" class="form-input" id="tradePrice" readonly>
        </div>
        <div class="form-group">
          <label class="form-label" id="tradeAmountLabel">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –ø–æ–∫—É–ø–∫–∏</label>
          <input type="number" class="form-input" id="tradeAmount" min="1" step="1" placeholder="10">
          <div class="error-message" id="tradeError">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</div>
        </div>
        <div class="form-group">
          <label class="form-label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</label>
          <input type="text" class="form-input" id="tradeTotal" readonly>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn btn-primary" onclick="confirmTrade()" id="tradeConfirmBtn">–ö—É–ø–∏—Ç—å</button>
      </div>
    </div>
  </div>
  
  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
  <div class="notification" id="notification">
    <div class="notification-icon">‚úì</div>
    <div class="notification-content">
      <h4 id="notificationTitle">–£—Å–ø–µ—à–Ω–æ!</h4>
      <p id="notificationMessage">–í–∞—à–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ.</p>
    </div>
    <div class="notification-close" onclick="hideNotification()">√ó</div>
  </div>
  
  <!-- –ß–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π, –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç -->
  <div class="card" id="support-chat">
    <div style="display: flex; justify-content: center; align-items: center; position: relative;">
      <h2 style="margin: 0 auto; text-align: center; flex:1;">–ß–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π</h2>
      <button id="close-chat" style="position: absolute; right: 0;">&times;</button>
    </div>
    <div id="chat-messages"></div>
    <form id="chat-form">
      <input type="text" id="chat-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
      <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>
  </div>
  
  <!-- –°–∫—Ä–∏–ø—Ç—ã -->
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
  <script>
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
    function toggleTheme() {
      const body = document.body;
      const currentTheme = body.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π —Ç–µ–º—ã
    if (localStorage.getItem('theme') === 'light') {
      document.body.setAttribute('data-theme', 'light');
    }
    
    // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.1 });
    
    document.querySelectorAll('.asset-card').forEach((el) => {
      observer.observe(el);
    });
    
    // –§–∏–∫—Å–∞—Ü–∏—è —à–∞–ø–∫–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
    window.addEventListener('scroll', () => {
      const header = document.getElementById('header');
      if (window.scrollY > 50) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    });
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
    function openModal(type, asset = null) {
      closeModal(); // –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –º–æ–¥–∞–ª–∫–∏
      
      if (type === 'deposit') {
        document.getElementById('depositModal').style.display = 'flex';
        document.getElementById('depositAmount').focus();
      } else if (type === 'withdraw') {
        document.getElementById('withdrawModal').style.display = 'flex';
        document.getElementById('withdrawAmount').focus();
      } else if (type === 'buy' || type === 'sell') {
        const modal = document.getElementById('tradeModal');
        document.getElementById('tradeModalTitle').textContent = type === 'buy' ? `–ü–æ–∫—É–ø–∫–∞ ${asset}` : `–ü—Ä–æ–¥–∞–∂–∞ ${asset}`;
        document.getElementById('tradeAsset').value = asset;
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–Ω—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–∫—Ç–∏–≤–∞ (—ç—Ç–æ –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
        let price = 0;
        if (asset === 'AAPL') price = 178.72;
        else if (asset === 'TSLA') price = 699.20;
        else if (asset === 'GLD') price = 168.45;
        else if (asset === 'BTC') price = 42350.00;
        
        document.getElementById('tradePrice').value = `$${price.toFixed(2)}`;
        document.getElementById('tradeAmountLabel').textContent = type === 'buy' ? '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –ø–æ–∫—É–ø–∫–∏' : '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏';
        document.getElementById('tradeConfirmBtn').textContent = type === 'buy' ? '–ö—É–ø–∏—Ç—å' : '–ü—Ä–æ–¥–∞—Ç—å';
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
        document.getElementById('tradeAmount').oninput = function() {
          const amount = parseFloat(this.value) || 0;
          const total = amount * price;
          document.getElementById('tradeTotal').value = total > 0 ? `$${total.toFixed(2)}` : '';
        };
        
        modal.style.display = 'flex';
        document.getElementById('tradeAmount').focus();
      }
    }
    
    function closeModal() {
      document.querySelectorAll('.modal-overlay').forEach(modal => {
        modal.style.display = 'none';
      });
    }
    
    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
    function confirmDeposit() {
      const amount = parseFloat(document.getElementById('depositAmount').value);
      const error = document.getElementById('depositError');
      
      if (!amount || amount < 100) {
        error.style.display = 'block';
        return;
      }
      
      error.style.display = 'none';
      closeModal();
      showNotification('–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞', `–ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ $${amount.toFixed(2)} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É.`);
    }
    
    function confirmWithdraw() {
      const amount = parseFloat(document.getElementById('withdrawAmount').value);
      const details = document.getElementById('withdrawDetails').value;
      const error = document.getElementById('withdrawError');
      
      if (!amount || amount < 100 || !details) {
        error.textContent = !details ? '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã' : '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –±–æ–ª—å—à–µ 100$';
        error.style.display = 'block';
        return;
      }
      
      error.style.display = 'none';
      closeModal();
      showNotification('–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤', `–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ $${amount.toFixed(2)} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É.`);
    }
    
    function confirmTrade() {
      const amount = parseInt(document.getElementById('tradeAmount').value);
      const error = document.getElementById('tradeError');
      
      if (!amount || amount < 1) {
        error.style.display = 'block';
        return;
      }
      
      error.style.display = 'none';
      closeModal();
      const action = document.getElementById('tradeConfirmBtn').textContent.toLowerCase();
      const asset = document.getElementById('tradeAsset').value;
      showNotification('–¢–æ—Ä–≥–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è', `${action} ${amount} ${asset} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ.`);
    }
    
    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    function showNotification(title, message) {
      const notification = document.getElementById('notification');
      document.getElementById('notificationTitle').textContent = title;
      document.getElementById('notificationMessage').textContent = message;
      
      notification.classList.add('show');
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
      setTimeout(() => {
        notification.classList.remove('show');
      }, 5000);
    }
    
    function hideNotification() {
      document.getElementById('notification').classList.remove('show');
    }
    
    // –ß–∞—Å—Ç–∏—Ü—ã
    particlesJS('particles-js', {
      "particles": {
        "number": {
          "value": 80,
          "density": {
            "enable": true,
            "value_area": 800
          }
        },
        "color": {
          "value": "#00e676"
        },
        "shape": {
          "type": "circle",
          "stroke": {
            "width": 0,
            "color": "#000000"
          },
          "polygon": {
            "nb_sides": 5
          }
        },
        "opacity": {
          "value": 0.5,
          "random": true,
          "anim": {
            "enable": true,
            "speed": 1,
            "opacity_min": 0.1,
            "sync": false
          }
        },
        "size": {
          "value": 3,
          "random": true,
          "anim": {
            "enable": true,
            "speed": 2,
            "size_min": 0.1,
            "sync": false
          }
        },
        "line_linked": {
          "enable": true,
          "distance": 150,
          "color": "#00e676",
          "opacity": 0.2,
          "width": 1
        },
        "move": {
          "enable": true,
          "speed": 1,
          "direction": "none",
          "random": true,
          "straight": false,
          "out_mode": "out",
          "bounce": false,
          "attract": {
            "enable": true,
            "rotateX": 600,
            "rotateY": 1200
          }
        }
      },
      "interactivity": {
        "detect_on": "canvas",
        "events": {
          "onhover": {
            "enable": true,
            "mode": "grab"
          },
          "onclick": {
            "enable": true,
            "mode": "push"
          },
          "resize": true
        },
        "modes": {
          "grab": {
            "distance": 140,
            "line_linked": {
              "opacity": 0.5
            }
          },
          "push": {
            "particles_nb": 4
          }
        }
      },
      "retina_detect": true
    });

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–æ–º
    const chatToggle = document.getElementById('support-chat-toggle');
    const chatWindow = document.getElementById('support-chat');
    const closeChatBtn = document.getElementById('close-chat');

    chatToggle.onclick = () => {
      chatWindow.classList.toggle('is-open');
      if(chatWindow.classList.contains('is-open')) {
        loadMessages();
      }
    };
    closeChatBtn.onclick = () => {
        chatWindow.classList.remove('is-open');
    };
    function formatTime(isoString) {
        if (!isoString) return '';
        try {
            return new Date(isoString).toLocaleTimeString('uk-UA', { hour: '2-digit', minute: '2-digit' });
        } catch(e) { return ''; }
    }

    function escapeHtml(text) {
      var map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
      return text.replace(/[&<>"']/g, function(m) { return map[m]; });
    }

    function loadMessages() {
      fetch('/chat/messages').then(r=>r.json()).then(data=>{
        const box = document.getElementById('chat-messages');
        if (!data.length) {
          box.innerHTML = '<div style="color:#aaa;text-align:center;">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</div>';
          return;
        }
        box.innerHTML = data.map(m => `
            <div class="chat-bubble ${m.sender === 'user' ? 'user' : 'admin'}">
                <span>${escapeHtml(m.message)}</span>
                <span class="timestamp">${formatTime(m.timestamp)}</span>
            INTO messages</div>
        `).join('');
        box.scrollTop = box.scrollHeight;
      });
    }
    document.getElementById('chat-form').onsubmit = function(e) {
      e.preventDefault();
      const input = document.getElementById('chat-input');
      const msg = input.value.trim();
      if (!msg) return;
      fetch('/chat/send', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msg})})
        .then(()=>{
          input.value='';
          setTimeout(loadMessages, 100); // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
        });
    };
    setInterval(loadMessages, 2000);
    loadMessages();
  </script>
</body>
</html>
